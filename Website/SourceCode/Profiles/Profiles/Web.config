<?xml version="1.0" encoding="utf-8"?>
<!--/*

Copyright (c) 2008-2010 by the President and Fellows of Harvard College. All rights reserved.
Profiles Research Networking Software was developed under the supervision of Griffin M Weber, MD, PhD.,
and Harvard Catalyst: The Harvard Clinical and Translational Science Center, with support from the
National Center for Research Resources and Harvard University.


Code licensed under a BSD License.
For details, see: LICENSE.txt

*/-->
<configuration>
  <configSections>
    <section name="exceptionHandling" type="Microsoft.Practices.EnterpriseLibrary.ExceptionHandling.Configuration.ExceptionHandlingSettings, Microsoft.Practices.EnterpriseLibrary.ExceptionHandling"/>
    <section name="loggingConfiguration" type="Microsoft.Practices.EnterpriseLibrary.Logging.Configuration.LoggingSettings, Microsoft.Practices.EnterpriseLibrary.Logging"/>
    <section name="dataConfiguration" type="Microsoft.Practices.EnterpriseLibrary.Data.Configuration.DatabaseSettings, Microsoft.Practices.EnterpriseLibrary.Data"/>
    <section name="cachingConfiguration" type="Microsoft.Practices.EnterpriseLibrary.Caching.Configuration.CacheManagerSettings,Microsoft.Practices.EnterpriseLibrary.Caching"/>
    <section name="ORNG" type="Profiles.ORNG.Utilities.ORNGSettings"/>
  </configSections>
  <appSettings>
    <add key="ValidationSettings:UnobtrusiveValidationMode" value="None" />
    <add key="SPARQLEndPoint" value="http://[DOMAIN NAME HERE]/[APP or SUBWEB NAME HERE]/ProfilesSPARQLAPI.svc/Search"/>
    <add key="DEBUG" value="true"/>
    <add key="DEBUG_PATH" value="C:\logs\Debug_Logging.log"/>
    <add key="CACHE_EXPIRE" value="1000"/>
    <add key="COMMANDTIMEOUT" value="500"/>
    <add key="ShowInstitutions" value="true"/>
    <add key="ShowDepartments" value="true"/>
    <add key="ShowDivisions" value="false"/>
    <add key="ShowOtherOptions" value="true"/>
    <add key="Login.PresentationXML" value="LoginFormPresentation"/>
    <add key="Shibboleth.ShibIdentityProvider" value="https://idp.testshib.org/idp/shibboleth" />
    <add key="Shibboleth.UserNameHeader" value="HTTP_REMOTEUSER" />
    <add key="Shibboleth.LoginURL" value="https://profiles-dev.umassmed.edu/Shibboleth.sso/Login?"/>
    <add key="Shibboleth.LogoutURL" value="https://profiles-dev.umassmed.edu/Shibboleth.sso/Logout?"/>
    <add key="Shibboleth.SessionID" value="HTTP_SHIBSESSIONID" />
    <add key="aspnet:MaxHttpCollectionKeys" value="10000"/>
    <add key="ORCID.Enabled" value="0"/>
    <add key="ORCID.PathToProfiles" value="http://localhost:55956"/>
    <add key="ORCID.ClientID" value=""/>
    <add key="ORCID.ClientSecret" value=""/>
    <add key="ORCID.ORCID_API_URL" value="http://api.sandbox.orcid.org"/>
    <add key="ORCID.ORCID_URL" value="http://sandbox.orcid.org"/>
    <add key="ORCID.WebAppURL" value="http://localhost:55956/ORCID/"/>
    <add key="ORCID.OrganizationName" value="Umass Medical School Profiles to ORCID Integration Site"/>
    <add key="ORCID.OrganizationNameShort" value="UMMSORCID"/>
    <add key="ORCID.OrganizationNameAorAN" value="an"/>
    <add key="ORCID.CheckOrganizationNameEmailSuffix" value="0"/>
    <add key="ORCID.OrganizationNameEmailSuffix" value="bu.edu;bumc.bu.edu;va.gov"/>
    <add key="ORCID.ProductionURL" value="https://orcid.org/"/>
    <add key="ORCID.InfoSite" value=""/>
    <add key="ORCID.MessageVersion" value="1.2"/>
    <add key="ORCID.RequireAcknowledgement" value="0"/>
    <add key="ORCID.AcknowledgementInfoSite" value="[LINK TO INSTITUTION TERMS AND CONDITIONS PAGE]"/>
    <add key="ORCID.AcknowledgementInfoSiteText" value="Institution ORCID Terms and Conditions of Use."/>
    <add key="ORCID.BatchCreateSize" value="1000"/>
    <add key="ORCID.UseMailinatorEmailAddressForTestingOnStagingEnvironment" value="1"/>
    <add key="ORCID.ShowNoORCIDMessage" value="1"/>
    <add key="EAGLEI.EmailAddress" value="eagle-i@example.com"/>
    <add key="EAGLEI.InstitutionName" value="[Enter University Name Here]"/>
    <add key="GrantEndPoint" value="http://profiles.catalyst.harvard.edu/services/NIHGrants/SearchGrants.asp"/>
    <add key="GoogleAnalytics.TrackingID" value=""/>
    <add key="isSearchSecondaryNodes" value="true"/>
    <add key="NIH.EUtilz.URI" value="https://eutils.ncbi.nlm.nih.gov/entrez/eutils"/>
    <!-- Password Reset Form Settings.  The username and password fields can be left empty if the configured server doesn't require authentication. -->
    <add key="PasswordReset.Smtp.Host" value="" />
    <!--<add key="PasswordReset.Smtp.Host" value="smtp.sendgrid.net" />-->
    <add key="PasswordReset.Smtp.Port" value="25" />
    <add key="PasswordReset.Smtp.UserName" value="azure_e1d6c15a125d37cbc17985794441ec5a@azure.com" />
    <add key="PasswordReset.Smtp.Password" value="UM@ssS3nd1813" />
    <add key="PasswordReset.FromAddress" value="support@ummassmed.edu" />
    <add key="PasswordReset.FromName" value="UMass Profiles Support" />
    <add key="PasswordReset.Subject" value="UMass Profiles Password Reset" />
    <!-- Expire time for the reset request.  -->
    <add key="PasswordReset.ExpireTime.Hours" value="24" />
    <!-- Number of times the user is allowed to have the password sent per 24 hour period. -->
    <add key="PasswordReset.ResendRequests.Allowed" value="3" />
    <!-- Regex used for password validation. -->
    <add key="PasswordReset.PasswordValidation.ValidationExpression" value="^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{6,128}$" />
    <add key="PasswordReset.PasswordValidation.ErrorMessage" value="Password must have one uppercase letter, one lowercase letter, a number and be at least 6 characters long." />
    <!-- Rich Text Editor for Overview / Narrative Settings -->
    <add key="RichTextEditor.EditHTMLSource.Enable" value="true" />
    <!-- Cloud storage account information -->
    <add key="ProfilesFileStorageURL" value="https://profilesimageszimmelb.azureedge.net/UploadFile?code=cX06J2IBkBGPoh0sx6INTA7yMWL3MqnTYd1LWsImxbqhm5UD5kU43A=="/>
    <add key="ProfilesImageStorageURL" value="https://profilesimageszimmelb.azureedge.net/UploadImage?code=cX06J2IBkBGPoh0sx6INTA7yMWL3MqnTYd1LWsImxbqhm5UD5kU43A=="/>
    <add key="ProfilesImageStorageName" value="Profiles"/>
  </appSettings>
  <ORNG Enabled="false" ShindigURL="http://[DOMAIN NAME HERE]/shindigorng" Features="container:views:rpc:jsonld:orng" TokenService="[SERVER NAME HERE]:8777" SocketPoolMin="3" SocketPoolMax="10" SocketPoolExpire="1000" SocketReceiveTimeout="5000" SearchLimit="100" SandboxPassword=""/>
  <dataConfiguration defaultDatabase="ProfilesDB"/>
  <connectionStrings>
    <add name="ProfilesDB" connectionString="Data Source=profilesbetasql.eastus.cloudapp.azure.com;Initial Catalog=ProfilesRNS;User ID=App_Profiles10;Password=x9UMA$$rns; Max Pool Size=1000" providerName="System.Data.SqlClient;" />
  </connectionStrings>
  <cachingConfiguration defaultCacheManager="Default Cache Manager">
    <backingStores>
      <add name="inMemory" type="Microsoft.Practices.EnterpriseLibrary.Caching.BackingStoreImplementations.NullBackingStore, Microsoft.Practices.EnterpriseLibrary.Caching"/>
    </backingStores>
    <cacheManagers>
      <add name="Default Cache Manager" type="Microsoft.Practices.EnterpriseLibrary.Caching.CacheManager, Microsoft.Practices.EnterpriseLibrary.Caching" expirationPollFrequencyInSeconds="60" maximumElementsInCacheBeforeScavenging="1000" numberToRemoveWhenScavenging="10" backingStoreName="inMemory"/>
      <add name="Loading Scenario Cache Manager" type="Microsoft.Practices.EnterpriseLibrary.Caching.CacheManager, Microsoft.Practices.EnterpriseLibrary.Caching" expirationPollFrequencyInSeconds="60" maximumElementsInCacheBeforeScavenging="1000" numberToRemoveWhenScavenging="10" backingStoreName="inMemory"/>
    </cacheManagers>
  </cachingConfiguration>
  <!--
    For a description of web.config changes see http://go.microsoft.com/fwlink/?LinkId=235367.

    The following attributes can be set on the <httpRuntime> tag.
      <system.Web>
        <httpRuntime targetFramework="4.5.2" />
      </system.Web>
  -->
  <system.web>
    <authentication mode="Forms"/>
    <compilation debug="true" targetFramework="4.5.2" />
    <customErrors mode="Off" defaultRedirect="/Error/Default.aspx">
      <error statusCode="404" redirect="~/Search" />
    </customErrors>
    <!--customErrors mode="RemoteOnly">
    </customErrors -->
    <pages controlRenderingCompatibilityVersion="3.5" clientIDMode="AutoID" />

  </system.web>
  <!-- Allow validation mode 2.0 for the default edit page.  This allows HTML to be submitted from the 
       TinyMCE editor. -->
  <location path="edit/default.aspx">
    <system.web>
      <pages validateRequest="false"/>
      <httpRuntime requestValidationMode="2.0"/>
    </system.web>
  </location>
  <system.webServer>
    <handlers accessPolicy="Read, Execute, Script">
      <add name="rdfxml" path="*.rdf" verb="*" modules="IsapiModule" scriptProcessor="C:\Windows\Microsoft.NET\Framework64\v4.0.30319\aspnet_isapi.dll" resourceType="Unspecified" requireAccess="Execute" preCondition="classicMode,runtimeVersionv4.0,bitness64" />
      <add name="SVC Script Mapping" path="*.svc" verb="*" modules="IsapiModule" scriptProcessor="C:\Windows\Microsoft.NET\Framework64\v2.0.50727\aspnet_isapi.dll" resourceType="File" preCondition="classicMode,runtimeVersionv2.0,bitness64" />
    </handlers>

    <defaultDocument>
      <files>
        <remove value="default.aspx" />
        <remove value="iisstart.htm" />
        <remove value="index.html" />
        <remove value="index.htm" />
        <remove value="Default.asp" />
        <remove value="Default.htm" />
        <add value="default.aspx" />
      </files>
    </defaultDocument>
    <rewrite>
      <rules>
        <clear />
        <rule name="2 to 2.9 (exact match search)" patternSyntax="ExactMatch" stopProcessing="true">
          <match url="profiles/search" />
          <conditions logicalGrouping="MatchAll" trackAllCaptures="false" />
          <action type="Redirect" url="https://{HTTP_HOST}" />
        </rule>
        <rule name="2 to 2.9 (search)" stopProcessing="true">
          <match url="profiles/search(.+)" />
          <conditions logicalGrouping="MatchAll" trackAllCaptures="false" />
          <action type="Redirect" url="https://{HTTP_HOST}" appendQueryString="true" redirectType="Permanent" />
        </rule>
        <rule name="2 to 2.9 (display)" stopProcessing="true">
          <match url="profiles/display/(.+)" />
          <conditions logicalGrouping="MatchAll" trackAllCaptures="false" />
          <action type="Redirect" url="https://{HTTP_HOST}/display/{R:1}" appendQueryString="true" redirectType="Permanent" />
        </rule>
        <rule name="Redirect HTTP to HTTPS " stopProcessing="true">
          <match url="(.*)" />
          <conditions logicalGrouping="MatchAll" trackAllCaptures="false">
            <add input="{HTTPS}" pattern="^OFF$" />
          </conditions>
          <action type="Redirect" url="https://{HTTP_HOST}/{R:1}" redirectType="SeeOther" />
        </rule>
      </rules>
    </rewrite>


  </system.webServer>
</configuration>